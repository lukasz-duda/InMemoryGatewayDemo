Example shows use case test using in memory gateway instead of spy.